package ca.csf.mobile2.tp2.question

import android.annotation.SuppressLint
import android.content.Intent
import android.net.Uri
import androidx.appcompat.app.AppCompatActivity
import ca.csf.mobile2.tp2.R
import org.androidannotations.annotations.*
import ca.csf.mobile2.tp2.databinding.ActivityCreateQuestionBinding
import ca.csf.mobile2.tp2.question.viewModels.CreateQuestionActivityViewModel

@SuppressLint("Registered") //Reason : Generated by Android Annotations
@DataBound
@EActivity(R.layout.activity_create_question)
class CreateQuestionActivity : AppCompatActivity() {

    @BindingObject
    protected lateinit var binding: ActivityCreateQuestionBinding

    @InstanceState
    protected lateinit var viewModel: CreateQuestionActivityViewModel
    private lateinit var questionData: QuestionData

    @Bean
    protected lateinit var questionService: QuestionService

    @AfterViews
    protected fun onCreate() {
        if (!this::viewModel.isInitialized) {
            questionData = QuestionData()
            viewModel =
                CreateQuestionActivityViewModel(
                    questionData
                )
        }
        questionData = viewModel.questionData
        binding.viewModel = viewModel
    }

    @Click(R.id.createButton)
    protected fun createQuestion() {
        questionService.createQuestion(
            questionData,
            this::onSuccess,
            this::onServerError,
            this::onConnectivityError
        )
    }

    private fun onSuccess(question: QuestionData) {
        val questionIntent = Intent(Intent.ACTION_PICK).apply {
            // Show user only the contacts that include phone numbers.
            /*setDataAndType(
                Uri.parse("content://contacts"),
            )*/
        }
        startActivityForResult(questionIntent, 1)
    }

    private fun onServerError() {

    }

    private fun onConnectivityError() {

    }

}